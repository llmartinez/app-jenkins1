{% extends 'TicketBundle:Default:assessor_ticketing_layout.html.twig' %}

{% block header %}

    {% include 'TicketBundle:Default:assessor_header.html.twig' %}

{% endblock %}

{% block breadcrumb %}

    <ol class="breadcrumb" id="breadcrumb">
      <li><a href="{{ path('user_index') }}">{{ 'home'|trans }}</a></li>
      <li class="active">{{ 'menu.list_tickets'|trans }}</li>
    </ol>

{% endblock  %}

{% block main %}

{% for flashMessage in app.session.flashbag.get('popup') %}
     <p class="alert">{{ flashMessage|nl2br }}</p>
{% endfor %}
    
<div>
    {% if is_granted('ROLE_ASSESSOR') %}

        {% include 'TicketBundle:Workshop:assessor_workshop.html.twig' %}

    {% else %}
        {% set workshop = app.security.getToken().getUser().getWorkshop() %}
    {% endif %}

    {% include 'TicketBundle:Includes:_filters_assessor_ticket.html.twig' %}
</div>
<div class="info asr_info">

        {% if workshop != null and workshop.haschecks == true %}
        <div class="grid pull-right {% if workshop.numchecks <= 1 %}error{% endif %} ">
            {{ 'numchecks'|trans }}: {{ workshop.numchecks }}
        </div>
        {% endif %}

        <legend>{{ 'description'|trans }} <span class="pull-right" id="list_date"></span></legend>
        <p id="list_description"></p><br>

        <legend>{{ 'solution'|trans }}</legend>
        <p id="list_solution"></p><br>

        {# APP BTNS #}
        {% include 'TicketBundle:Includes:_ged_btns.html.twig' %}
</div>
<div class="content">
    {% include 'TicketBundle:Includes:_buttons_assessor_ticket.html.twig' %}

    {# Definicion de la ruta al listado para usar en paginacion #}
    {% set route = 'listTicket' %}

    <div class="grid-full w100">
        <div class="grid-20">

            <input type="hidden" id="route"    value= {{ route    }}>
            <input type="hidden" id="country"  value= {{ country  }}>
            <input type="hidden" id="lang"     value= {{ lang     }}>
            <input type="hidden" id="catserv"  value= {% if catserv is defined and catserv.id is defined %} {{ catserv.id  }} {% else %}0{% endif %}>
            <input type="hidden" id="num_rows" value= {{ num_rows }}>
            <input type="hidden" id="option"   value= {{ option   }}>
            <input type="hidden" id="workshop_id"  value= {% if workshop is defined and workshop.id is defined %} {{ workshop.id  }} {% else %}0{% endif %}>
            {% if adviser_id is defined %}
                <input type="hidden" id="adviser_id"   value= {{ adviser_id   }}>
            {% endif %}
            <input type="hidden" id="href_tickets" value="{{ path(route, {'page': '1', 'country': 'plc_country', 'lang': 'plc_lang', 'catserv': 'plc_catserv', 'num_rows': 'plc_rows', 'option': 'plc_option', 'workshop_id': 'plc_workshop_id', 'adviser_id': 'plc_adviser_id' }) }}">

            <label>{{ 'filter_by_type'|trans }}</label>
            <select id="slct_historyTickets" class="form-control asr_form-control">

                {% if is_granted('ROLE_ADMIN') %}
                        <option value="all" selected="selected" >{{ 'ticket.opt.all'|trans }}</option>
                        <option value="opened"                  >{{ 'ticket.opt.open'|trans }}</option>
                        <option value="closed"                  >{{ 'ticket.opt.closed'|trans }}</option>
                        <option value="free"                    >{{ 'ticket.opt.free'|trans }}</option>
                        <option value="pending"                 >{{ 'ticket.opt.pending'|trans }}</option>
                        <option value="answered"                >{{ 'ticket.opt.answered'|trans }}</option>
                        <option value="inactive"                >{{ 'ticket.inactive'|trans }}</option>
                        <option value="expirated"               >{{ 'ticket.expirated'|trans }}</option>
                {% else %}
                    {% if is_granted('ROLE_ASSESSOR') %}
                        <option value="free" selected="selected">{{ 'ticket.opt.free'|trans }}</option>
                        <option value="all_mine"                >{{ 'ticket.opt.all_mine'|trans }}</option>
                        <option value="assessor_pending"        >{{ 'ticket.opt.assessor.pending'|trans }}</option>
                        <option value="assessor_answered"       >{{ 'ticket.opt.assessor.answered'|trans }}</option>
                        <option value="assessor_closed"         >{{ 'ticket.opt.assessor.closed'|trans }}</option>
                        <option value="other_pending"           >{{ 'ticket.opt.other.pending'|trans }}</option>
                        <option value="other_answered"          >{{ 'ticket.opt.other.answered'|trans }}</option>
                        <option value="other_closed"            >{{ 'ticket.opt.other.closed'|trans }}</option>
                        <option value="inactive"                >{{ 'ticket.inactive'|trans }}</option>
                        <option value="expirated"               >{{ 'ticket.expirated'|trans }}</option>
                        <option value="all"                     >{{ 'ticket.opt.all'|trans }}</option>
                    {% endif %}
                {% endif %}
            </select>
        </div>
        <div class="grid-15">
            <label>{{ 'category_service'|trans }}</label>
            <select id="flt_catserv" class='form-control asr_form-control' {% if is_granted('ROLE_ADMIN') and not is_granted('ROLE_SUPER_ADMIN') %}disabled="disabled"{% endif %}>

                {% if catservices|length == 1 %}
                    <option value="{{catservices[0].id}}" selected>{{catservices[0].categoryService}}</option>
                {% else %}
                    <option value="0">{{ 'category_service'|trans }}</option>
                    {% for _catserv in catservices %}
                        <option value="{{ _catserv.id }}" {% if catserv is defined and catserv.id is defined and catserv.id == _catserv.id %} selected {% endif %}>{{_catserv.categoryService}}</option>
                    {% endfor %}
                {% endif %}
            </select>
        </div>
        <div class="grid-15">
            <label>{{ 'country'|trans }}</label>
            <select id="flt_country" class='form-control asr_form-control' {% if is_granted('ROLE_ADMIN') and not is_granted('ROLE_SUPER_ADMIN') %}disabled="disabled"{% endif %}>
                    <option value="0">{{ 'country'|trans }}</option>
                {% for _country in countries %}
                    <option value="{{ _country.id }}" {% if country == _country.id %} selected {% endif %}>{{ _country | trans }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="grid-15">
            <label>{{ 'language'|trans }}</label>
            <select id="flt_language" class='form-control asr_form-control' {% if is_granted('ROLE_ADMIN') and not is_granted('ROLE_SUPER_ADMIN') %}disabled="disabled"{% endif %}>
                    <option value="0">{{ 'language'|trans }}</option>
                {% for _language in languages %}
                    <option value="{{ _language.id }}" {% if lang == _language.id %} selected {% endif %}>{{ _language | trans }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="grid-15">
            <label>{{ 'filter_by_rows'|trans }}</label>
            <select id="slct_numRows" class="form-control asr_form-control">
                <option value="10" selected="selected" >10</option>
                <option value="20" >20</option>
                <option value="50" >50</option>
            </select>
        </div>
        <div class="grid-15">
            <label>{{ 'assessor'|trans }}</label>
            <select id="flt_adviser" class='form-control asr_form-control'>
                    <option value="0">{{ 'assessor'|trans }}</option>
                {% for _adviser in advisers %}
                    <option value="{{ _adviser.id }}" {% if adviser_id is defined and adviser_id == _adviser.id %} selected {% endif %}>{{ _adviser.name}} {{_adviser.surname}}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    {% if is_granted('ROLE_ASSESSOR') %}
        {% include 'TicketBundle:Ticket:list_assessor_ticket.html.twig'    %}
    {% else %}
        {% set workshop = app.security.getToken().getUser().getWorkshop() %}
        {% include 'TicketBundle:Ticket:list_assessor_ticket.html.twig' %}
    {% endif %}
</div>

{% endblock  %}

{% block additionalJavascripts %}{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/ticket/js/ticket_history.js' ) }}"></script>
    <script src="{{ asset('bundles/ticket/js/ticket_workshop.js') }}"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            {% if option != '' %} $('#slct_historyTickets').val("{{ option }}"); {% else %} $('#slct_historyTickets').val('all'); {% endif %}
        });
    </script>
{% endblock %}