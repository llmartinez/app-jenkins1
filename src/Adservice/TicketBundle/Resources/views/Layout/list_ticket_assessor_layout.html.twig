{% extends 'TicketBundle:Default:assessor_ticketing_layout.html.twig' %}

{% block header %}

    {% include 'TicketBundle:Default:assessor_header.html.twig' %}

{% endblock %}

{% block breadcrumb %}

    <ol class="breadcrumb" id="breadcrumb">
      <li><a href="{{ path('user_index') }}">{% trans %} home {% endtrans %}</a></li>
      <li class="active">{% trans %} menu.list_tickets {% endtrans %}</li>
    </ol>

{% endblock  %}

{% block main %}

<div>
    {% if is_granted('ROLE_ASSESSOR') %}

        {% include 'TicketBundle:Workshop:assessor_workshop.html.twig' %}

    {% else %}
        {% set workshop = app.security.getToken().getUser().getWorkshop() %}
    {% endif %}

    {% include 'TicketBundle:Includes:_filters_assessor_ticket.html.twig' %}
</div>
<div class="info asr_info">

        {% if workshop != null and workshop.haschecks == true %}
        <div class="grid pull-right {% if workshop.numchecks <= 1 %}error{% endif %} ">
            {% trans %}numchecks{% endtrans %}: {{ workshop.numchecks }}
        </div>
        {% endif %}

        <legend>{% trans %} description {% endtrans %} <span class="pull-right" id="list_date"></span></legend>
        <p id="list_description"></p><br>

        <legend>{% trans %} solution {% endtrans %}</legend>
        <p id="list_solution"></p><br>

        {# APP BTNS #}
        {% include 'TicketBundle:Includes:_ged_btns.html.twig' %}
</div>
<div class="content">
    {% include 'TicketBundle:Includes:_buttons_assessor_ticket.html.twig' %}

    {# Definicion de la ruta al listado para usar en paginacion #}
    {% set route = 'listTicket' %}

    <div class="grid-full w100">
        <div class="grid-20">

            <input type="hidden" id="route"    value= {{ route    }}>
            <input type="hidden" id="country"  value= {{ country  }}>
            <input type="hidden" id="lang"     value= {{ lang  }}>
            <input type="hidden" id="catserv"  value= {% if catserv is defined and catserv.id is defined %} {{ catserv.id  }} {% else %}0{% endif %}>
            <input type="hidden" id="num_rows" value= {{ num_rows }}>
            <input type="hidden" id="option"   value= {{ option   }}>
            <input type="hidden" id="href_tickets" value="{{ path(route, {'page': '1', 'country': 'plc_country', 'lang': 'plc_lang', 'catserv': 'plc_catserv', 'num_rows': 'plc_rows', 'option': 'plc_option' }) }}">


            <label>{% trans %} filter_by_type {% endtrans %}</label>
            <select id="slct_historyTickets" class="form-control asr_form-control">

                {% if is_granted('ROLE_ADMIN') %}
                        <option value="all" selected="selected" >{% trans %} ticket.opt.all               {% endtrans %}</option>
                        <option value="opened"                  >{% trans %} ticket.opt.open              {% endtrans %}</option>
                        <option value="closed"                  >{% trans %} ticket.opt.closed            {% endtrans %}</option>
                        <option value="free"                    >{% trans %} ticket.opt.free              {% endtrans %}</option>
                        <option value="pending"                 >{% trans %} ticket.opt.pending           {% endtrans %}</option>
                        <option value="answered"                >{% trans %} ticket.opt.answered          {% endtrans %}</option>
                        <option value="inactive"                >{% trans %} ticket.opt.inactive          {% endtrans %}</option>
                {% else %}
                    {% if is_granted('ROLE_ASSESSOR') %}
                        <option value="free" selected="selected">{% trans %} ticket.opt.free              {% endtrans %}</option>
                        <option value="all_mine"                >{% trans %} ticket.opt.all_mine          {% endtrans %}</option>
                        <option value="assessor_pending"        >{% trans %} ticket.opt.assessor.pending  {% endtrans %}</option>
                        <option value="assessor_answered"       >{% trans %} ticket.opt.assessor.answered {% endtrans %}</option>
                        <option value="assessor_closed"         >{% trans %} ticket.opt.assessor.closed   {% endtrans %}</option>
                        <option value="other_pending"           >{% trans %} ticket.opt.other.pending     {% endtrans %}</option>
                        <option value="other_answered"          >{% trans %} ticket.opt.other.answered    {% endtrans %}</option>
                        <option value="other_closed"            >{% trans %} ticket.opt.other.closed      {% endtrans %}</option>
                        <option value="all"                     >{% trans %} ticket.opt.all               {% endtrans %}</option>
                    {% endif %}
                {% endif %}
            </select>
        </div>
        <div class="grid-20">
            <label>{% trans %} category_service {% endtrans %}</label>
            <select id="flt_catserv" class='form-control asr_form-control' {% if is_granted('ROLE_ADMIN') and not is_granted('ROLE_SUPER_ADMIN') %}disabled="disabled"{% endif %}>

                {% if catservices|length == 1 %}
                    <option value="{{catservices[0].id}}" selected>{{catservices[0].categoryService}}</option>
                {% else %}
                    <option value="0">{% trans %} category_service {% endtrans %}</option>
                    {% for _catserv in catservices %}
                        <option value="{{ _catserv.id }}" {% if catserv is defined and catserv.id is defined and catserv.id == _catserv.id %} selected {% endif %}>{{_catserv.categoryService}}</option>
                    {% endfor %}
                {% endif %}
            </select>
        </div>
        <div class="grid-20">
            <label>{% trans %} country {% endtrans %}</label>
            <select id="flt_country" class='form-control asr_form-control' {% if is_granted('ROLE_ADMIN') and not is_granted('ROLE_SUPER_ADMIN') %}disabled="disabled"{% endif %}>
                    <option value="0">{% trans %} country {% endtrans %}</option>
                {% for _country in countries %}
                    <option value="{{ _country.id }}" {% if country == _country.id %} selected {% endif %}>{{ _country | trans }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="grid-20">
            <label>{% trans %} language {% endtrans %}</label>
            <select id="flt_language" class='form-control asr_form-control' {% if is_granted('ROLE_ADMIN') and not is_granted('ROLE_SUPER_ADMIN') %}disabled="disabled"{% endif %}>
                    <option value="0">{% trans %} language {% endtrans %}</option>
                {% for _language in languages %}
                    <option value="{{ _language.id }}" {% if lang == _language.id %} selected {% endif %}>{{ _language | trans }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="grid-20">
            <label>{% trans %} filter_by_rows {% endtrans %}</label>
            <select id="slct_numRows" class="form-control asr_form-control">
                <option value="10" selected="selected" >10</option>
                <option value="20" >20</option>
                <option value="50" >50</option>
            </select>
        </div>
    </div>

    {% if is_granted('ROLE_ASSESSOR') %}
        {% include 'TicketBundle:Ticket:list_assessor_ticket.html.twig'    %}
    {% else %}
        {% set workshop = app.security.getToken().getUser().getWorkshop() %}
        {% include 'TicketBundle:Ticket:list_assessor_ticket.html.twig' %}
    {% endif %}
</div>

{% endblock  %}

{% block additionalJavascripts %}{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/ticket/js/ticket_history.js' ) }}"></script>
    <script src="{{ asset('bundles/ticket/js/ticket_workshop.js') }}"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            {% if option != '' %} $('#slct_historyTickets').val("{{ option }}"); {% else %} $('#slct_historyTickets').val('all'); {% endif %}
        });
    </script>
{% endblock %}