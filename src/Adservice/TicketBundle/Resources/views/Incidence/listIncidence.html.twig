{% extends "TicketBundle:Default:incidence.html.twig" %}

{% block content %}

    <h3>Incidencias</h3>
    
    <div class="tblContainer">
        {% if is_granted('ROLE_ASSESSOR') %}
        <div>
            <p> <a class="btn btn-primary " href="{{ path('newIncidence') }}">Nueva Incidencia</a>
        </div>
        {% endif %}
    
        {# Busca una incidencia #}
        
        <form action="{{ path('listIncidence') }}" id="contact" class="form" role="form" method="post">
            <div class="col-xs-6 col-md-6 form-group">    
                Buscar por ID: <input type='text' id='id_incidence' name='id_incidence'>
            </div>
            <div class="row">
                <div class="col-xs-12 col-md-12 form-group">
                    <button class="btn btn-primary pull-right" type="submit">Submit</button>
                </div>
            </div>
        </form>
        
        {# Si encuentra un ticket #}
        <table class="table table-striped table-bordered">
            <tr><td>
                {% if incidence is not null%}
                    {% if incidence.id is not null %}
                        {% if (incidence.ticket.owner.id == app.security.getToken().getUser().getId()) or is_granted('ROLE_ASSESSOR') %}

                            <p>Incidencia #{{ incidence.id }} ( {{ incidence.createdAt | date("d-m-Y") }}) -> {{ incidence.status }}
                                    <a class="btn btn-primary pull-right"  href="{{ path('showIncidence', { 'id_incidence' : incidence.id }) }}">Ver</a> </p> 
                        {% else %}
                            <p>No tienes acceso a esta incidencia</p>
                        {% endif %}
                    {% endif %}                    
                {% else %}
                    <p>La incidencia que has buscado no existe</p> 
                {% endif %}
            </td></tr>
        </table>
    </div>    
{% endblock %}