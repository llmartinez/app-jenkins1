{% extends "::base.html.twig" %}

{% block postjs %}
    <script>
        $(document).ready(function(){
        
            $('#make').change(function(){
                {# Vaciamos siempre el valor de version al cambiar de make #}
                var options = $("#version");
                options.empty();
                options.append(($("<option />").text("{% trans %}Select model first{% endtrans %}")));
                
                {# Realizamos esto siempre y cuando el valor sea verídico #}
                if($("#make option:selected").val() != 0){
                    
                    {# Mensaje en el select mientras carga los modelos #}
                    $("#model").html('<option>{% trans %}Loading models from{% endtrans %} '+$(this[this.selectedIndex]).text()+'...</option>');

                    {# Llamada AJAX al controlador para recuperar los modelos de la marca #}
                    $.ajax({
                        url: 'ticket/pickModel/'+$("#make option:selected").val(),
                        type: 'GET',
                        dataType: 'json',
                        
                        success: function(data){
                            var options = $("#model");
                            options.empty();
                            options.append(($("<option />").text("{% trans %}Model not specified{% endtrans %}")));
                            
                            $.each(data, function(){
                                options.append($("<option />").val(this.id).text(this.name));
                            })
                            
                            $('#model').change(function(){
                                {# Vuelvo a empezar, ahora para la versión #}
                                {# Realizamos esto siempre y cuando el valor sea verídico #}
                                if($("#model option:selected").val() != 0){
                                   
                                    {# Mensaje en el select mientras carga los modelos #}
                                    $("#version").html('<option>{% trans %}Loading versions from{% endtrans %} '+$(this[this.selectedIndex]).text()+'...</option>');

                                    {# Llamada AJAX al controlador para recuperar las versiones del modelo #}
                                    $.ajax({
                                        url: 'ticket/pickVersion/'+$("#model option:selected").val(),
                                        type: 'GET',
                                        dataType: 'json',
                                        
                                        success: function(data){
                                            var options = $("#version");
                                            options.empty();
                                            options.append(($("<option />").text("{% trans %}Version not specified{% endtrans %}")));
                                            
                                            $.each(data, function(){
                                                options.append($("<option />").val(this.id).text(this.name));
                                            })
                                            
                                            {# Aquí vendría otra operación en cadena si hubiera que ponerla #}
                                        }
                                    })
                                } else {
                                    var options = $("#version");
                                    options.empty();
                                    options.append(($("<option />").text("{% trans %}Select model first{% endtrans %}")));
                                }
                            })
                        }
                    })
                } else {
                    var options = $("#model");
                    options.empty();
                    options.append(($("<option />").text("{% trans %}Select make first{% endtrans %}")));
                }
            })
            
            $('#system').change(function(){
                {# Realizamos esto siempre y cuando el valor sea verídico #}
                if($("#system option:selected").val() != 0){
                    
                    {# Mensaje en el select mientras carga los sistemas #}
                    $("#subsystem").html('<option>{% trans %}Loading subsystems from{% endtrans %} '+$(this[this.selectedIndex]).text()+'...</option>');

                    {# Llamada AJAX al controlador para recuperar los subsistemas del sistema #}
                    $.ajax({
                        url: 'ticket/pickSubsys/'+$("#system option:selected").val(),
                        type: 'GET',
                        dataType: 'json',
                        
                        success: function(data){
                            var options = $("#subsystem");
                            options.empty();
                            options.append(($("<option />").text("{% trans %}Subsystem not specified{% endtrans %}")));
                            
                            $.each(data, function(){
                                options.append($("<option />").val(this.id).text(this.name));
                            })
                        }
                    })
                } else {
                    var options = $("#subsystem");
                    options.empty();
                    options.append(($("<option />").text("{% trans %}Select system first{% endtrans %}")));
                }
            })
        });
    </script>
{% endblock %}