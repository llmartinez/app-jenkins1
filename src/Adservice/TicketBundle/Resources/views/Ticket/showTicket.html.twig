{% extends "TicketBundle:Default:ticket.html.twig" %}

{% block content %}

    <h3>
        <a href="{{ path('listTicket') }}">Tickets:</a> 
        
        #{{ ticket.id }} - {{ ticket.title | length > 100 ?  ticket.title | slice(0, 100) ~ '...' : ticket.title }} 
    </h3>
    
   {# Datos del TICKET #}
                
        <div class="tblContainer">
        <table class="table table-striped table-bordered">
            <tr>    
                <td>                    
                    {% if is_granted('ROLE_ADMIN') %}
                        
                        <a class="btn btn-primary pull-right" href="{{ path('editTicket', { 'id_ticket': ticket.id }) }}">Editar</a>
                    {% endif %}
                        
                    <p>Taller:  {{ ticket.createdBy.username }}</p>
                    
                    <p>Fecha:  {{ ticket.createdAt | date("d-m-Y") }}  ( {{ ticket.status }} ) </p>
                </td>
            </tr>
        </table>
    </div>    
    
    {# mensajes del TICKET #}
    
        {% set nPosts = posts | length %}
            
        {% for i in 2..1 %}
        <div class='txtContainer'>
            {% if posts[nPosts-i] is defined %}
                
            <fieldset>

            {# Marca con un color diferente los mensajes del usuario #}
                
                {% if posts[nPosts-i].createdBy.id == app.security.getToken().getUser().getId() %}
                
                    <legend style="background: azure;"> {{ posts[nPosts-i].createdBy.username }}</legend>
                    
                {% else %}
                    
                    <legend> {{ posts[nPosts-i].createdBy.username }}</legend>
                {% endif %}

                    <p> {{ posts[nPosts-i].message }} </p>
                    
            </fieldset>
            {% endif %}
        </div>
        {% endfor %}   

        <a class='pull-right' href='{{ path('showPost', { 'id_ticket': ticket.id }) }}'>Ver todos ({{ nPosts }})</a>

        {% if ticket.status.id == 1 %}

            <a class="btn btn-primary pull-right btn100" style="background-color:gray">TICKET CERRADO<a>

        {% else %}
                    
            <form action="{{ path('showTicket', {'id_ticket' : id_ticket}) }}" id="contact" class="form" role="form" method="post">

                <input type="hidden" id="user" name="user" value="{{ app.security.getToken().getUser().getId() }}">

                <section>
                    <h5>Responde: </h5>
                    <div>
                        {{ form_widget(form.message, { 'attr': {'class': 'ac-message', 'rows': '7'} }) }}
                        <button class="btn btn-primary pull-right btn100" type="submit">Enviar</button>
                    </div>
                </section>
            </form>

            {% if is_granted('ROLE_ADMIN') %}

                <a class="btn btn-primary pull-right btn100" href="{{ path('createIncidence', { 'id_ticket': ticket.id }) }}">CERRAR TICKET<a>

            {% endif %}
        {% endif %}
{% endblock %}
                     
                        
                        
                        
                        
                        
                        
{# mensajes del TICKET (version MIN)
    
                
                
        <section class="ac-container" >
            
        {% set nPosts = posts | length %}
            
        {% for i in 2..1 %}
            {% if posts[nPosts-i] is defined %}
                <div id="post{{ posts[nPosts-i].id }}">
#}
                {# Marca con un color diferente los mensajes del usuario 

                    {% if posts[nPosts-i].createdBy.id == app.security.getToken().getUser().getId() %}

                        <label for="ac-{{ loop.index }}" style="background: azure;"> {{ posts[nPosts-i].createdBy.username }}</label>

                    {% else %}

                        <label for="ac-{{ loop.index }}"> {{ posts[nPosts-i].createdBy.username }}</label>
                    {% endif %}
#}
                {# Cambia el css del ultimo mensaje para que aparezca abierto 

                    {% if loop.last %}

                        <input id="ac-{{ loop.index }}" name="accordion-1" type="checkbox" checked /> 
                        <article class="ac-medium">

                    {% else %}

                        <input id="ac-{{ loop.index }}" name="accordion-1" type="checkbox" />
                        <article class="ac-small">

                    {% endif %}
                        <p> {{ posts[nPosts-i].message | length > 200 ?  posts[nPosts-i].message | slice(0, 200) ~ '...' : posts[nPosts-i].message }} </p>
                    </article>
                </div>
            {% endif %}
        {% endfor %}
                
        </section>

        <a class='comment' href='{{ path('showPost', { 'id_ticket': ticket.id }) }}'>Ver Comentarios ({{ nPosts }})</a>
               
        {% if ticket.status.id == 1 %}

            <a class="btn btn-primary pull-right btn100" style="background-color:gray">TICKET CERRADO<a>
                
        {% else %}        
            <form action="{{ path('showTicket', {'id_ticket' : id_ticket}) }}" id="contact" class="form" role="form" method="post">

                <input type="hidden" id="user" name="user" value="{{ app.security.getToken().getUser().getId() }}">

                <section class="ac-container" >
                    <h5>Responde: </h5>
                    <div>
                        {{ form_widget(form.message, { 'attr': {'class': 'ac-message', 'rows': '7'} }) }}
                        <button class="btn btn-primary pull-right btn100" type="submit">Enviar</button>
                    </div>
                </section>
            </form>
        
            {% if is_granted('ROLE_ADMIN') %}

                <a class="btn btn-primary pull-right btn100" href="{{ path('createIncidence', { 'id_ticket': ticket.id }) }}">CERRAR TICKET<a>

            {% endif %}
        {% endif %}
{% endblock %}

#}