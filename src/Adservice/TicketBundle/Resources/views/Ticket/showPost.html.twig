{% extends "TicketBundle:Default:ticket.html.twig" %}

{% block content %}

    <h3><a href="{{ path('listTicket') }}">Tickets:</a> 
    {{ ticket.title | length > 100 ?  ticket.title | slice(0, 100) ~ '...' : ticket.title }}  </h3>
    
   {# Datos del TICKET #}
                
        <div class="tblContainer">
        <table class="table table-striped table-bordered">
            <tr>    
                <td>                    
                    {% if is_granted('ROLE_ADMIN') %}
                        <a class="btn btn-primary pull-right" href="{{ path('editTicket', { 'id_ticket': ticket.id }) }}">Editar</a>
                    {% endif %}
                    <p>Taller:  {{ ticket.owner.username }}</p>
                    <p>Fecha:  {{ ticket.createdAt | date("d-m-Y") }}  ( {{ ticket.status }} ) </p>
                </td>
            </tr>
        </table>
    </div>    
    
    
{# mensajes del TICKET #}
    
        {% for message in posts %}
        <div class='txtContainer'>        
            <fieldset>

            {# Marca con un color diferente los mensajes del usuario #}
                
                {% if message.owner.id == app.security.getToken().getUser().getId() %}
                
                    <legend style="background: azure;"> {{ message.owner.username }}
                    
                {% else %}
                    
                    <legend> {{ message.owner.username }}
                {% endif %}
                    </legend>
                        
                    <div class="colDer"> 
                        <p> {{ message.message }} </p> 
                    
                    </div>
                        
                    <div class="colIzq">
                        
                        {% include 'TicketBundle:Ticket:showDocument.html.twig' with {'documents': documents, 'msg_id': message.id} %}
                        
                    </div>
            </fieldset>
        </div>         
        {% endfor %}
                
        <hr>
        {% if ticket.status.id == 1 %}

            <a class="btn btn-primary pull-right btn100" style="background-color:gray">TICKET CERRADO<a>

        {% else %}
                    
            <form action="{{ path('showPost', {'id_ticket' : id_ticket}) }}" id="contact" class="form" role="form" method="post" enctype="multipart/form-data">

                <input type="hidden" id="user" name="user" value="{{ app.security.getToken().getUser().getId() }}">

                <section>
                    <h5>Responde: </h5>
                    <div>
                        {{ form_widget(form.message, { 'attr': {'class': 'ac-message', 'rows': '7'} }) }}
                        
                    </div>
                </section>

                {{ form_widget(formF.file, { 'attr': {'class': 'ac-message'} })  }}

                <button class="btn btn-primary pull-right btn100" type="submit">Enviar</button>
            </form>
                    
            {% if is_granted('ROLE_ADMIN') %}

                <a class="btn btn-primary pull-right btn100" href="{{ path('createIncidence', { 'id_ticket': ticket.id }) }}">CERRAR TICKET<a>

            {% endif %}
        {% endif %}
{% endblock %}