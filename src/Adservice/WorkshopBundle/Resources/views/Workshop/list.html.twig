{% extends '::layout.html.twig' %}

{% block body %}
    {# Definicion de la ruta al listado para usar en paginacion #}
    {% set route = 'workshop_list' %}
    {% if app.security.getToken().getUser().getCategoryService().getId() is defined %}
               {% set id_catserv = app.security.getToken().getUser().getCategoryService().getId() %}
    {% else %} {% set id_catserv = '0' %}
    {% endif %}
    <input type="hidden" id="route" name="route" value="{{ route }}">

    <ol class="breadcrumb">
      <li><a href="{{ path('user_index') }}">{% trans %} home {% endtrans %}</a></li>
      <li class="active">{% trans %} menu.list_workshops {% endtrans %}</li>
    </ol>

    <div style="width: 90%; margin-left: 5%;">

        <legend>{% trans %} menu.list_workshops {% endtrans %}
            {% if is_granted('ROLE_TOP_AD') %}
                <a id="newWorkshop" href="{{ path('workshop_new') }}" class="btn btn-primary"><img class="img_icon" src="{{ asset('bundles/util/images/icon/add.png') }}"> {% trans %} new.workshop {% endtrans %}</a></td>
            {% endif %}
            <span class="pull-right mr15">{% trans %}menu.list_workshops{% endtrans %}: {{length}}</span>
        </legend>

        {% if app.session.hasFlash('alert') %}<p class="alert">{{ app.session.getFlash('alert') }}</p>{% endif %}

        <input type="hidden" id="code_numeric" name="code_numeric" value="{% trans %} code_numeric {% endtrans %}">
        <input type="hidden" id="code_partner" name="code_partner" value="{% trans %} code_partner {% endtrans %}">
        <div class="grid w15">
            <label style="width: 100%;">    {% trans %} code  {% endtrans %} <a id="lbl_code" style="color:red"></a></label>
            <input type="text" id="w_idpartner" name="w_idpartner" class="btn50 floating form-control" style="width: 50%;" placeholder="{% trans %} partner  {% endtrans %}">
            <input type="text" id="w_id"        name="w_id"        class="btn50 floating form-control" style="width: 50%;" placeholder="{% trans %} workshop {% endtrans %}">
        </div>

        {% if is_granted('ROLE_TOP_AD') %}
            {% if is_granted('ROLE_ADMIN') %}
                <div class="grid w10 form-group pd0"> <label> {% trans %} country {% endtrans %} </label>
                    <select id="flt_country" class='form-control'>
                            <option value="0">{% trans %} all {% endtrans %}</option>
                        {% for country in countries %}
                            <option value="{{ country.id }}">{{ country | trans }}</option>
                        {% endfor %}
                </select></div>
            {% endif %}
          {% if not is_granted('ROLE_SUPER_ADMIN') %}
              <div class="grid w15 form-group pd0">
                  <label> {% trans %} category_service {% endtrans %} </label>
                  <select disabled id="slct_catserv" class="form-control"> 

                      <option value="{{ catser.id }}">{{ catser.CategoryService }}</option>

                  </select>
              </div>
        
          {% else %}
              <div class="grid w15 form-group pd0">
                <label> {% trans %} category_service {% endtrans %} </label>
                <select id="slct_catserv" class="form-control"> <option value="0">...</option>
                    {% for _catserv in cat_services %}
                        <option value="{{ _catserv.id }}"{% if _catserv is defined and catserv == _catserv.id %} selected {% endif %}>{{ _catserv }}</option>
                    {% endfor %}
                </select>
            </div>
          {% endif %}
      
            <div class="grid w10 form-group pd0"> <label> {% trans %} partner {% endtrans %} </label>
                <select id="flt_partner" class='form-control'>
                        <option value="0">{% trans %} all {% endtrans %}</option>
                    {% for partner in partners %}
                        <option value="{{ partner.id }}">{{ partner.codePartner }} - {{ partner | trans }}</option>
                    {% endfor %}
            </select></div>

            <div class="grid w10 form-group pd0"> <label> {% trans %} status {% endtrans %} </label>
                <select id="flt_status" class='form-control'>
                    <option value="0"        >{% trans %} all      {% endtrans %}</option>
                    <option value="active"   >{% trans %} active   {% endtrans %}</option>
                    <option value="deactive" >{% trans %} inactive {% endtrans %}</option>
                    <option value="test"     >{% trans %} test     {% endtrans %}</option>
                    <option value="check"    >{% trans %} haschecks{% endtrans %}</option>
                    <option value="infotech" >{% trans %} infotech {% endtrans %}</option>
                 </select>
            </div>

            <div class="grid w30 form-group pd0">
                <div class="col-xs-6 col-md-6 form-group" style="margin-left: -15px;">
                    <label> {% trans %} find_by {% endtrans %} </label>
                    <select id="flt_search_term" name="flt_search_term" class='form-control'>
                        <option value="tel"  {% if term == 'tel'  %}selected{% endif %}>{% trans %} tel   {% endtrans %}</option>
                        <option value="name" {% if term == 'name' %}selected{% endif %}>{% trans %} name  {% endtrans %}</option>
                        <option value="mail" {% if term == 'mail' %}selected{% endif %}>{% trans %} email {% endtrans %}</option>
                        <option value="cif"  {% if term == 'cif'  %}selected{% endif %}>{% trans %} cif   {% endtrans %}</option>
                        <option value="postal_code"  {% if term == 'postal_code'  %}selected{% endif %}>{% trans %} postal_code   {% endtrans %}</option>
                        <option value="city"  {% if term == 'city'  %}selected{% endif %}>{% trans %} city   {% endtrans %}</option>
                     </select>
                </div>
                <div class="col-xs-5 col-md-5 form-group" style="margin-top: 21px;margin-left: -25px;">
                    <input type="text" id="flt_search_field" name="flt_search_field" class='form-control' placeholder="{% trans %} value {% endtrans %}" value="{% if field != '0' %}{{ field }}{% endif %}">
                </div>
                <div class="col-xs-1 col-md-1 form-group" style="margin-left:-16px;">
                    <a type="button" id="btn_search_field" name="btn_search_field" class='btn btn-primary' style="margin-top:20px;margin-left:-20px;"><img class="img_icon" src="{{ asset('bundles/util/images/icon/search_btn.png') }}"></a>
                </div>
            </div>

        {% endif %}
    </div>
    {% include 'WorkshopBundle:Workshop:_list.html.twig'  %}

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/util/js/pagination.js') }}"></script>
    <script src="{{ asset('bundles/workshop/js/workshop_filter.js') }}"></script>
    <script>
        $(document).ready(function() {
            {% if country != '0' %} $("#flt_country").val('{{ country }}');{% endif %}
            {% if partner != '0' %} $("#flt_partner").val('{{ partner }}');{% endif %}
            {% if status  != '0' %} $("#flt_status" ).val('{{ status }}' );{% endif %}
        });
    </script>
{% endblock %}